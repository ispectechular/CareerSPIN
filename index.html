<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Career SPIN</title>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <style>
    :root{
      --brandPurple:#4A7A92;
      --text:#111827;
      --muted:#6b7280;
      --accent:#4A7A92;
      --card:#ffffff;
      --border:#e5e7eb;
      --radius:16px;
      --danger:#b91c1c;
      --focus:#2563eb;
    }
    *{box-sizing:border-box}
    body{margin:0;background:#fff;color:var(--text);font-family:'Lexend',system-ui,Arial,sans-serif}
    .wrap{max-width:980px;margin:0 auto;padding:24px}
    h1{color:var(--brandPurple);font-size:28px;font-weight:700;margin:0 0 8px}
    .subnote{font-size:12px;color:var(--muted);margin-bottom:12px}
    .meta{display:grid;grid-template-columns:repeat(4,minmax(160px,1fr));gap:12px;margin:12px 0 20px}
    .field{display:flex;flex-direction:column;gap:6px}
    .field span{font-size:12px;color:var(--muted)}
    .field input,.field select{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#fff}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:0 8px 24px rgba(0,0,0,0.06);padding:16px;margin:12px 0}
    .card h2{margin:0 0 8px;font-size:18px;color:var(--brandPurple)}
    .row{margin:8px 0}
    .helper{font-size:12px;color:var(--muted);margin-top:6px}
    .error{font-size:12px;color:var(--danger);margin-top:6px}
    label.option{display:flex;gap:10px;align-items:flex-start;margin:6px 0}
    input[type="text"],textarea,select{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#fff}
    textarea{min-height:110px;resize:vertical}
    .req::after{content:' *';color:var(--danger)}

    .bar{display:flex;justify-content:flex-end;align-items:center;gap:12px;margin-top:16px}
    .btn{border:none;border-radius:12px;padding:10px 14px;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
    .btn:disabled{opacity:.6;cursor:not-allowed}

    .toast{position:fixed;right:16px;bottom:16px;display:none;align-items:center;gap:10px;background:#ecfdf5;border:1px solid #a7f3d0;color:#065f46;border-radius:12px;padding:12px 14px;box-shadow:0 10px 30px rgba(0,0,0,.15);z-index:9999}
    .toast a{font-weight:700;text-decoration:underline;color:#065f46}
    .toast .close{margin-left:6px;border:none;background:transparent;cursor:pointer;color:#065f46;font-weight:700}

    /* Modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.35);display:none;align-items:center;justify-content:center;padding:16px}
    .modal{max-width:820px;width:100%;background:#fff;border-radius:16px;border:1px solid var(--border);box-shadow:0 20px 60px rgba(0,0,0,0.2)}
    .modal header{padding:16px 18px;border-bottom:1px solid var(--border);color:var(--brandPurple);font-weight:700}
    .modal .content{max-height:60vh;overflow:auto;padding:12px 18px}
    .modal .actions{display:flex;justify-content:flex-end;gap:10px;padding:12px 18px;border-top:1px solid var(--border)}
    .kv{display:grid;grid-template-columns:200px 1fr;gap:8px;padding:8px 0;border-bottom:1px dashed var(--border)}
    .kv b{color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>My Career SPIN</h1>
    <div class="subnote">Complete all required items. Your teacher will receive your submission as a PDF.</div>

    <!-- META -->
    <div class="meta">
      <label class="field"><span class="req">Student Name (First &amp; Last)</span><input id="m_name" type="text" placeholder="Ex. John Smith" required></label>
      <label class="field"><span class="req">Student Email</span><input id="m_email" type="email" placeholder="Ex. first.last@students.wawasee.k12.in.us" required></label>
      <label class="field"><span class="req">Grade</span><input id="m_grade" type="text" placeholder="Ex. 12th Grade" required></label>
      <label class="field"><span class="req">Date</span><input id="m_date" type="date" required></label>
      <label class="field"><span class="req">Teacher of Record</span>
        <select id="m_teacher"><option value="">Select your teacher…</option></select>
        <div id="err_teacher" class="error" style="display:none">Please select your teacher.</div>
      </label>
    </div>

    <!-- QUESTIONS -->
    <div id="qroot"></div>

    <!-- ACTIONS -->
    <div class="bar"><button id="submit" class="btn">Submit</button></div>
    <div id="status" class="helper" aria-live="polite"></div>

    <!-- Toast -->
    <div id="toast" class="toast" role="status" aria-live="polite">
      <span id="toast_msg">Survey submitted.</span>
      <a id="toast_link" href="#" target="_blank" rel="noopener">View your PDF</a>
      <button class="close" id="toast_close" aria-label="Dismiss notification">×</button>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div class="modal-backdrop" id="confirm_modal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="confirm_title">
      <header id="confirm_title">Review your responses</header>
      <div class="content" id="confirm_content"></div>
      <div class="actions">
        <button id="back_btn" class="btn ghost">Go back and edit</button>
        <button id="confirm_btn" class="btn">Confirm &amp; Submit</button>
      </div>
    </div>
  </div>
<script>
/********************
 * CONFIG + STATE
 ********************/
const GAS_ENDPOINT = 'https://script.google.com/macros/s/AKfycbxqZqobN7NZCxe1GMFioykj7wUEWMs30dF8NxTIRBUwKAlll1BuQNZshYqRJGpDlS2p/exec';
const TEACHERS = [
  { name:'Jesse Ritter', email:'jritter@wawasee.k12.in.us' },
  { name:'Christine Troutman', email:'ctroutman@wawasee.k12.in.us' },
  { name:'Jill Hackleman', email:'Jill.hackleman@wawasee.k12.in.us' },
  { name:'David Shipley', email:'dshipley@wawasee.k12.in.us' },
  { name:'Wendy Ortiz', email:'wortiz@wawasee.k12.in.us' }
];
const STATE = { meta:{}, answers:{} };

const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));

/********************
 * INIT + HELPERS
 ********************/
function todayISO() {
  const d = new Date();
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
}
function getSelectedTeacher() {
  const idx = $('#m_teacher').value;
  return idx === '' ? null : TEACHERS[Number(idx)];
}
function toB64(blob) {
  return new Promise(res=>{
    const fr=new FileReader();
    fr.onload=()=>res(fr.result.split(',')[1]);
    fr.readAsDataURL(blob);
  });
}

/********************
 * UI UTILITIES
 ********************/
function showToast(message, linkHref){
  const toast=$('#toast');
  $('#toast_msg').textContent=message||'Survey submitted';
  const a=$('#toast_link');
  if(a){ a.href=linkHref||'#'; a.style.display=linkHref?'inline':'none'; }
  toast.style.display='flex';
  setTimeout(()=>toast.style.display='none',10000);
}
$('#toast_close')?.addEventListener('click',()=>$('#toast').style.display='none');

/********************
 * RENDER QUESTIONS
 ********************/
const SCHEMA = [
  {qid:'career_interest',type:'text',prompt:'What career are you most interested in?',required:true},
  {qid:'career_reason',type:'long_text',prompt:'What makes you interested in this career?',required:true},
  {qid:'career_strengths',type:'long_text',prompt:'What strengths will help you be successful in your desired career? List 3 or more.',required:true}
];
function render(){
  const root=$('#qroot');
  root.innerHTML='';
  SCHEMA.forEach(q=>{
    const card=document.createElement('div');
    card.className='card';
    const h=document.createElement('h2');
    h.textContent=q.prompt;
    if(q.required) h.classList.add('req');
    card.appendChild(h);

    let input;
    if(q.type==='text'){
      input=document.createElement('input');
      input.type='text';
    } else {
      input=document.createElement('textarea');
    }
    input.oninput=e=>STATE.answers[q.qid]=e.target.value;
    card.appendChild(input);
    root.appendChild(card);
  });
}

/********************
 * VALIDATE + MODAL
 ********************/
function validate(){
  const teacher=getSelectedTeacher();
  if(!$('#m_name').value.trim()||!$('#m_email').value.trim()||!$('#m_grade').value.trim()||!$('#m_date').value.trim()){
    alert('Please fill in all required fields.');
    return false;
  }
  if(!teacher){
    $('#err_teacher').style.display='block';
    return false;
  }
  let ok=true;
  SCHEMA.forEach(q=>{
    const v=STATE.answers[q.qid];
    if(!v||!v.trim()) ok=false;
  });
  if(!ok) alert('Please answer all required questions.');
  return ok;
}

function openConfirm(){
  const t=getSelectedTeacher();
  const html=`
    <div class='kv'><b>Student</b><div>${$('#m_name').value}</div></div>
    <div class='kv'><b>Email</b><div>${$('#m_email').value}</div></div>
    <div class='kv'><b>Grade</b><div>${$('#m_grade').value}</div></div>
    <div class='kv'><b>Date</b><div>${$('#m_date').value}</div></div>
    <div class='kv'><b>Teacher</b><div>${t?.name||''}</div></div>
  `;
  $('#confirm_content').innerHTML=html;
  $('#confirm_modal').style.display='flex';
}
function closeConfirm(){ $('#confirm_modal').style.display='none'; }

/********************
 * PDF + SUBMIT
 ********************/
async function buildPDF(){
  const {jsPDF}=window.jspdf;
  const doc=new jsPDF({unit:'pt',format:'letter'});
  const m={
    name:$('#m_name').value,
    email:$('#m_email').value,
    grade:$('#m_grade').value,
    date:$('#m_date').value
  };
  const teacher=getSelectedTeacher();
  let y=48;
  doc.setFont('helvetica','bold');
  doc.setFontSize(16);
  doc.text('My Career SPIN',48,y);y+=18;
  doc.setFont('helvetica','normal');
  doc.setFontSize(11);
  doc.text(`Student: ${m.name}  Email: ${m.email}  Grade: ${m.grade}`,48,y);y+=14;
  doc.text(`Date: ${m.date}  Timestamp: ${new Date().toISOString()}`,48,y);y+=14;
  doc.text(`Teacher of Record: ${teacher?teacher.name:''}`,48,y);y+=18;
  doc.setDrawColor(229,231,235);
  doc.line(48,y,564,y);y+=10;
  SCHEMA.forEach(q=>{
    doc.setFont('helvetica','bold');
    const qText=doc.splitTextToSize(q.prompt,480);
    doc.text(qText,48,y);y+=qText.length*13;
    doc.setFont('helvetica','normal');
    const a=STATE.answers[q.qid]||'—';
    const aText=doc.splitTextToSize(a,480);
    doc.text(aText,48,y);y+=aText.length*13+10;
  });
  return doc.output('blob');
}

async function doSubmit(){
  const teacher=getSelectedTeacher();
  if(!teacher) return;
  $('#confirm_btn').disabled=true;
  $('#submit').disabled=true;
  const pdf=await buildPDF();
  const base=`My Career SPIN - ${$('#m_name').value} - ${new Date().getFullYear()}`;
  const pdfFile=new File([pdf],base+'.pdf',{type:'application/pdf'});
  const payload={
    to:teacher.email,
    subject:`My Career SPIN Submission - ${new Date().toISOString().slice(0,10)}`,
    student:{student_name:$('#m_name').value,grade:$('#m_grade').value,teacher_name:teacher.name},
    files:[{filename:pdfFile.name,mimeType:pdfFile.type,data:await toB64(pdfFile)}]
  };
  try{
    await fetch(GAS_ENDPOINT,{method:'POST',body:JSON.stringify(payload),mode:'no-cors'});
    const url=URL.createObjectURL(pdf);
    showToast('Survey submitted',url);
  }catch(e){ alert('Submission failed.'); }
  $('#confirm_btn').disabled=false;
  $('#submit').disabled=false;
  closeConfirm();
}

/********************
 * STARTUP
 ********************/
function initTeacher(){
  const sel=$('#m_teacher');
  TEACHERS.forEach((t,i)=>{
    const o=document.createElement('option');
    o.value=i;o.textContent=t.name;
    sel.appendChild(o);
  });
}
function main(){
  $('#m_date').value=todayISO();
  initTeacher();
  render();
  $('#submit').onclick=()=>{ if(validate()) openConfirm(); };
  $('#confirm_btn').onclick=doSubmit;
  $('#back_btn').onclick=closeConfirm;
}
main();
</script>
</body>
</html>



